# -*- encoding: utf-8 -*-
import os
import numpy as np
import math
import math
from langchain import PromptTemplate
from langchain.chat_models import ChatOpenAI
from langchain.embeddings.openai import OpenAIEmbeddings
from langchain.vectorstores import Chroma, Redis
from langchain.chains import RetrievalQA, ConversationalRetrievalChain, MapReduceDocumentsChain, StuffDocumentsChain, \
    ReduceDocumentsChain
from langchain.text_splitter import CharacterTextSplitter, RecursiveCharacterTextSplitter
from tenacity import retry, stop_after_attempt
from dotenv import load_dotenv

from variables import REDIS_ADDRESS, OPENAI_KEY

load_dotenv()

os.environ['OPENAI_API_KEY'] = OPENAI_KEY

import os, sys

def getnearpos(vector,value):
    idx = (np.abs(vector-value)).argmin()
    return idx

@retry(stop=stop_after_attempt(3))
def start(documentId, text):
    try:
        vectorizer = OpenAIEmbeddings(openai_api_key=os.environ['OPENAI_API_KEY'])

        text_splitter = RecursiveCharacterTextSplitter(chunk_size=500, chunk_overlap=0)
        all_splits = text_splitter.create_documents([text])
        for i, text in enumerate(all_splits):
            text.metadata["source"] = f"{i}-pl"

        rds = Redis.from_documents(
            all_splits,
            vectorizer,
            redis_url= f"redis://{REDIS_ADDRESS}",
            index_name=documentId
        )

        return None
    except Exception as error:
        print(error)
        print(
            type(error).__name__,  # TypeError
            __file__,  # /tmp/example.py
            error.__traceback__.tb_lineno  # 2
        )

def isPreviousOrNext(cluster_index_list, index):

    for i in cluster_index_list:
        previous = i - 1
        next = i + 1

        if next == index or previous == index:
            return True


    return False

if __name__ == '__main__':
    start('document-01', ' Fala  Concurseiros!  Chegamos  à  aula  de  número  3  aqui  de  substantivo,  né?  Lembrando  que  a  aplicabilidade  do  substantivo  é  mais  condicionada  ao  contexto  e  a  depender  da  banca  com  a  qual  você  queira  trabalhar,  mas  dificilmente  vai  mudar  o  que  nós  já  temos  mostrado  aqui.  O  tópico  que  queremos  ver  aqui  é  a  variação  de  gênero,  isso  mesmo,  gênero.  Você  sabe  que  em  língua  portuguesa,  gênero  trata  de  masculino  e  feminino.  Geralmente  essas  questões  de  gênero,  elas  são  trabalhadas  com  os  artigos,  elementos  com  os  quais  vocês  já  trabalharam,  nós  já  trabalhamos  aqui,  e  até  mesmo  com  pronomes  e  em  menor  escala  com  os  numerais,  beleza?  Aí  nós  temos  dois  tipos  aqui  de  substantivos.  O  primeiro  é  o  uniforme  e  o  segundo  é  o  substantivo  biforme.  Uniforme  indica  gêneros  diferentes  sem  mudar  a  forma,  enquanto  que  o  gênero  biforme  indica  gêneros  diferentes  com  mudança  de  forma.  Em  outras  palavras,  se  você  parar  para  de  fato  analisar,  você  vai  ver  que  aqui  dentro  da  palavra  uniforme  tem  a  palavra  1  e  dentro  da  palavra  biforme  tem  a  palavra  2,  beleza?  Uniforme  1,  biforme  2.  Uniforme  1,  biforme  2.  Bacana?  E  por  aí  você  sabe  mais  ou  menos  como  vai  ser  o  andar  da  carruagem  da  aula  de  hoje.  Seguindo  ainda,  olha  aqui,  o  que  eu  quero  que  você  entenda.  Perceba  que  você  tem  a  palavra  filho,  mas  você  também  tem  a  palavra  filha.  Filho,  filha.  Note  que  o  radical,  a  base  da  palavra,  bem  aqui,  continua  a  mesma,  entendeu?  A  base  da  palavra  continua  a  mesma.  Aí  você  começa  a  perceber  essa  diferença.  Oficial,  acredite  você  ou  não,  você  tem  aqui  a  oficiala.  O  brasileiro,  você  tem  a  brasileira.  O  diácono,  você  tem  a  diaconisa.  O  homem,  aí  você  já  tem  a  mulher,  né?  A  vaca,  você  já  tem  aqui  o  boi.  O  ator,  você  tem  a  atriz.  O  herói,  você  tem  a  heroína.  O  zangão,  você  tem  a  abelha.  Jabuti,  você  tem  a  jabota.  Guri,  você  tem  a  guria.  E  alemão,  você  tem  a  alemã.  Percebeu?  Aí  você  vê  o  que?  Poxa,  Silvio,  então  essa  galera  toda  aqui  é  um  substantivo  o  que?  São  substantivos  biformes.  Todos  eles  são  considerados  substantivos  biformes.  Por  quê?  Porque  eu  tenho  gêneros  diferentes,  bem  aqui,  diferentes  com  a  mudança  de  forma.  Você  viu  que  a  forma  não  mudou.  A  forma  continua  a  mesma.  Filho,  filha.  Aí  eu  posso  incluir  nesse  rol  gato,  porque  eu  também  tenho  o  feminino  que  é  gata.  Então  você  percebe  que  ele  aqui  serve  tanto  para  animais  quanto  para  seres  personativos  que  são  pessoas.  Então  você  tem  gato,  você  tem  gata,  você  tem  cavalo,  você  tem  égua.  Então  são  substantivos  biformes.  Por  quê?  Porque  ele  trata  os  gêneros  diferentes  com  a  mudança  de  forma.  Beleza?  E  seguindo  a  nossa  carruagem,  agora  vamos  falar  daqueles  que  são  considerados  substantivos  uniformes.  Como  o  próprio  nome  já  diz,  tem  uma  única  forma.  Mas  o  primeiro  detalhe  sobre  o  qual  eu  quero  falar  é  esse  aqui.  Comum  de  dois.  Ele  é  comum  para  os  dois  gêneros.  Por  aí  você  tira  a  definição  de  uniforme.  Refere -se  a  pessoas,  somente  a  pessoas,  e  o  gênero  é  indicado  por  determinante.  Esse  determinante  pode  ser  um  artigo,  pode  ser  um  pronome.  Entendeu?  Aqui  essas  classes  funcionam  como  determinantes.  Olha  aqui  o  sobrecomum.  Eu  quero  que  você  olhe  para  esse  um  aqui,  porque  é  somente  uma  palavra.  Ele  se  refere  somente  a  pessoas  e  o  gênero  dele  é  fixo  e  estático.  O  que  quer  dizer  isso,  Silvio?  Que  ele  tem  somente  uma  única  forma.  Somente  uma  única  forma.  E  essa  forma  ou  serve  para  o  masculino,  ou  serve  para  o  feminino,  ou  serve  para  os  dois.  Bacana?  E  aqui,  nos  substantivos  epsenos,  eles  se  referem  a  animais  e  plantas  e  o  gênero  é  indicado  por  determinantes.  Já  o  sexo  é  determinado  pelos  adjetivos  macho  e  fêmea.  Beleza?  Macho  e  fêmea.  Aonde  você  quer  chegar  com  isso,  Silvio?  Muita  gente  não  pode  ver  nome  de  animal  que  pensa  que  o  substantivo  é  epseno.  Por  favor,  preste  atenção  aqui  no  jabuti  e  na  jabota.  Preste  atenção  no  zangão  e  na  abelha,  no  carneiro  e  na  ovelha.  São  substantivos  biformes  porque  eles  têm  duas  formas.  Uma  para  o  masculino,  outra  para  o  feminino.  Bacana?  E  aí  você  começa  a  perceber  essa  diferença.  Vou  encher  a  tela  para  você  aqui.  Você  tem  aqui  a  palavra  agente.  Então,  você  tem  aqui,  dentro  da  palavra  agente,  por  exemplo,  você  não  tem  a  palavra  agenta.  Professor,  eu  vi  silêncio!  Ou  agente,  agente.  Percebeu?  É  o  mesmo  substantivo  que  serve  tanto  para  o  masculino  quanto  para  o  feminino.  Ele  aqui  vai  ser  chamado  de  comum  de  dois.  Eu  vou  colocar  bem  aqui,  CD,  que  quer  dizer  comum  de  dois.  Quando  você  for  estudar  depois,  você  vai  saber  do  que  eu  tenho  falado.  Bacana?  Olha  aqui  no  caso  da  palavra  dentista.  Você  tem  o  dentista  e  a  dentista.  É  a  mesma  forma  tanto  para  o  masculino  quanto  para  o  feminino.  E  aqui  eu  tenho  também  um  comum  de  dois.  Beleza?  Comum  de  dois.  Detalhe,  uma  dica  de  amigo.  Tudo  que  é  terminado  em  ista  já  é  comum  de  dois  gêneros.  Tudo  terminado  em  ista  é  comum  de  dois  gêneros.  Manobrista,  frentista,  finalista,  acabista.  Acabista,  não.  Mas,  ó,  frentista,  manobrista,  dentista,  maquinista,  frentista,  maquinista,  finalista,  frentista.  Olha  um  monte  de  exemplos,  entendeu?  Então,  aí  você  passa  também  um  pouco  pelo  conhecimento  de  mundo.  Você  tem  o  repórter  e  a  repórter,  ou  seja,  é  o  mesmo  substantivo  para  o  masculino  e  para  o  feminino.  Então,  nós  temos  aqui  um  substantivo  que  é  comum  de  dois  gêneros.  Olha  aqui,  diplomata.  Eu  também  tenho  aqui  em  diplomata  a  mesma  forma.  O  diplomata  e  a  diplomata.  E  aqui  o  diplomata,  a  diplomata,  eu  tenho  comum  de  dois  gêneros.  Bacana?  A  palavra  carrasco,  né?  A  palavra  carrasco,  ela  é  somente  masculina,  ela  é  o  carrasco.  Mas,  Silvio,  e  se  for,  se  eu  tiver  uma  professora  que  é  carrasca?  Bem,  a  palavra  carrasca,  ela  é  inexistente  na  língua  portuguesa,  mas  você  pode  falar.  Sabe  por  que  você  pode  falar?  Porque  a  boca  é  sua.  Você  pode  falar  porque  a  boca  é  sua.  Mas  o  que  eu  quero  que  você  entenda,  né?  É  que  o  carrasco  não  tem  carrasca.  A  professora  é  minha  carrasca?  Não.  A  professora  é  minha  carrasco?  Não.  A  professora  é  meu  carrasco.  Porque  isso  aqui  já  é  um  substantivo  chamado  de  sobre  comum.  Ele  tem  uma  única  forma  que  serve  tanto  para  o  masculino  quanto  para  o  feminino.  De  semelhante  modo,  acontece  com  cônjuge.  Se  você  for  uma  mulher,  o  seu  cônjuge  é  o  seu  companheiro.  Se  você  for  um  homem,  o  seu  cônjuge...  Ah,  mas  o  nome  da  minha  esposa  é  Joana.  O  seu  cônjuge  se  chama  Joana.  Mas  por  que  não  pode  ser  cônjuge  já?  Por  que  não  pode  ser  minha  cônjuge?  Porque  o  substantivo,  ele  é  masculino.  Então,  os  que  estiverem  atrelados  a  ele,  tem  que  ser  também.  Beleza?  Por  exemplo,  testemunha,  eu  também  tenho  aqui  sobre  comum,  porque  eu  só  tenho  aqui  na  língua  portuguesa  a  testemunha.  De  semelhante  modo,  eu  tenho  a  pessoa.  Então,  eu  também  tenho  o  substantivo  sobre  comum.  Olha  aqui  a  palavra  vítima.  Eu  só  tenho  a  vítima.  Mas  Silvio,  e  se  a  vítima  for  um  homem?  A  vítima  se  chama  Silvio.  A  vítima,  com  o  nome  de  Itacano,  chegou!  Entendeu?  Então,  esse  lance  aí  de  vítima,  isso  aí  é  um  substantivo  sobre  comum.  A  vítima,  a  vítima.  Aí  você  tem  fã,  você  tem  o  fã  e  a  fã.  Quando  você  tem  a  mesma  forma,  tanto  para  o  masculino  quanto  para  o  feminino,  é  porque  eu  tenho  aqui  um  substantivo  que  é  comum  de  dois,  né?  Mamoeiro,  lá  vai  canoeiro.  Ah,  não,  aqui  é  mamoeiro.  Mamoeiro  é  nome  de  planta.  Então,  você  tem  aqui  o  mamoeiro  macho  e  você  tem  também  aqui  o  mamoeiro  fêmea.  Fale  com  o  biólogo  que  ele  vai  explicar  melhor  para  você,  mas  uma  coisa  é  certa.  Eu  sei  que  esse  cara  aqui  é  o  quê?  É  um  substantivo  chamado  de  epseno.  Bacana?  Ó,  jacaré.  Não  existe  jacaroa,  jacaraã,  jacarana,  né?  É  porque  aqui  você  tem  jacaré  macho  e  jacaré  fêmea.  Você  percebeu  que  em  todos  os  momentos  nós  estamos  falando,  né,  de  substantivo.  Jacaré  macho,  jacaré  fêmea,  entendeu?  Não  tem  jacarana.  Aí  você  tem  cobra.  Você  tem  aqui,  ó,  cobra  macho,  cobra  fêmea.  Beleza?  E  aí,  fazendo  aqui  a  parada,  eu  já  sei  que  ele  é  um  substantivo  epseno.  Barata.  Também  eu  tenho  barata  macho  e  barata  fêmea.  Você  sabe  como  é  que  eu  faço  para  descobrir?  Não  sei.  Epseno.  Galo.  Você  é  o  quê?  Galo.  Eu  tenho  galinha.  Ou  seja,  eu  tenho  duas  formas.  Então  eu  tenho  um  substantivo  que  é  o  quê?  Duas  formas.  Duas  formas.  Se  eles  são  duas  formas,  olha  pra  mim,  se  eles  são  duas  formas,  eles  são  biformes,  entendeu?  Mas  galo,  galinha,  aqui  eles  são  substantivos  disfarçados.  Disfarçados.  São  biformes.  Bacana.  E  cachorro?  Você  tem  aqui  cachorro,  você  tem  cachorra.  Cachorro,  cachorra.  Aí  você  percebe  que  aqui  em  cachorro  e  cachorra,  você  tem  aqui  também  substantivos  biformes.  Show?  Beleza?  Tranquilo?  Então,  aqui,  Silvio,  então  quer  dizer  que  esses  dois  caras  apareceram  aqui  de  gaiato.  Vieram  de  gaiato,  né?  Galo,  galinha,  cachorro,  cachorra.  Mas  deu  pra  entender?  O  substantivo  comum  de  dois,  ele  é  comum  para  os  dois  gêneros.  Comum  para  os  dois  gêneros.  Os  substantivos  uniformes,  eles  somente  têm  uma  forma.  Eu  quero  chamar  atenção  pra  um  vocábulo  que  já  trouxe  muita  treta,  que  é  o  vocábulo  presidenta.  Beleza?  O  que  eu  quero  dizer?  A  palavra  presidenta,  ela  sempre  existiu  na  língua  portuguesa.  O  primeiro  registro  dela  pelo  Volpe,  que  é  o  vocabulário  ortográfico  da  língua  portuguesa,  ele  registrou  essa  palavra  a  primeira  vez  em  1932.  Entendeu?  Mas,  Silvio,  isso  aí  não  é  um  arranjo  político,  não.  Não  é  um  arranjo  político,  não.  A  questão  é  que  nós,  brasileiros,  nunca  fomos  motivados  a  chamar  presidenta.  Porque  nós  temos  aqui  um  equivalente,  que  é  o  equivalente  que  é  presidente.  E  aí  você  começa  a  perceber  que  você  tem...  O  que  a  língua  portuguesa  fez?  Ela  já  tinha  aqui  o  presidente  para  o  homem,  a  presidente  para  a  mulher.  Mas  aí  ela  criou  uma  forma  de  tentar  conduzir  essa  situação  e  deixou  presidente  no  feminino,  mas  deixou  presidenta  no  feminino,  mas  deixou  presidente  no  masculino  e  no  feminino.  Bacana?  Então,  presidente  é  usado  para  homem,  pode  ser  usado  para  mulher,  mas  presidenta  também  está  totalmente  registrada.  Beleza?  Tranquilo?  De  boa?  Ó  a  tela  cheia  pra  você  aí,  ó.  Tela  cheia  pra  você  aí,  ó.  Mudança  de  sentido.  Você  sabe  que  sempre  que  nós  falamos  sentido  aqui,  nós  estamos  falando  dela.  Sentido,  noção.  Beleza?  Como  é  que  funciona  isso,  Tite?  Assim,  ó.  Note  que  eu  tenho  uma  diferença  entre  usar  a  cabeça  e  o  cabeça.  O  cabeça  aqui  é  o  líder,  enquanto  que  a  cabeça  aqui  é  um  membro.  Ó,  a  capital  e  o  capital.  A  capital  é  a  cidade.  Cidade.  Enquanto  que  aqui,  ó,  o  capital  quer  dizer  o  quê?  Dinheiro,  recursos.  A  lotação  é  a  capacidade.  O  lotação  é  o  veículo.  Beleza?  Então,  o  lotação  é  o  veículo.  A  grama  e  o  grama.  Essa  grama  é  a  relva.  É  o  matinho  do  campo  de  futebol  do  Vasco.  Aí  você  tem  o  grama,  né?  A  grama  e  o  grama  e  o  grama  aqui  é  a  unidade  de  massa.  Beleza?  A  rádio  e  o  rádio.  Aqui,  ó,  em  a  rádio  é  a  estação.  É  uma  estação.  E  aqui  o  rádio  é  o  aparelho.  Beleza?  Aparelho.  Aqui  você  tem  a  caixa,  que  é  o  objeto,  e  você  tem  o  caixa,  que  é  uma  pessoa.  Beleza?  De  boa?  Então,  claro,  há  muitos  outros,  mas  o  que  vai  determinar  isso  aí  pra  você  é  o  contexto.  Bacana?  É  o  contexto.  O  que  é  o  contexto,  Silvio?  É  a  situação  de  fala.  Mãe!  Mãe!  Mãe!  Mãe!  Vamos  cortar.  Vamos  pegar  300  gramas  de  picanha.  Não,  300.  Porque  a  unidade  de  massa  aqui  é  masculina.  Então  é  300.  Beleza?  Tela  cheia  pra  você.  E  claro,  pra  não  perder  o  hábito,  vamos  fazer  aqui  uma  questãozinha.  Dessa  vez  a  questão  é  da  VUNESP.  Uma  banca  de  boa.  Olha  aí,  ó.  Nas  passagens  Proteção  à  Saúde  de  Todos  os  Candidatos  e  Proteger  a  Saúde  das  Crianças,  Jovens  e  Adolescentes,  o  substantivo  Cidadão  faz  o  plural  com  ão.  Sim,  cidadão,  cidadãos.  E  o  substantivo  Feminino,  Crianças,  refere -se  tanto  ao  sexo  masculino  quanto  ao  feminino.  Ou  seja,  se  se  refere  tanto  a  um  quanto  ao  outro,  professor,  então  nesse  caso  eu  acredito  que  ele  seja  uniforme.  Ele  é  uniforme.  Mas  ele  é  uniforme  o  quê?  E  aí?  Uniforme  o  quê?  Vamos  lá.  Se  refere  ao  sexo  tanto  masculino  quanto  feminino.  Substantivos  com  essas  mesmas  propriedades  gramaticais  empregados  em  sua  forma  do  singular  estão  destacados  correta  e  respectivamente.  Tabelião  é  tabeliães.  Já  manda  embora  aqui.  E  aqui,  a  gente,  você  sabe  que  é  comum  de  dois.  Aqui,  crianças,  é  um  sobrecomum.  E  aí  fica  tudo  de  boa.  Letra  B.  Durante  a  missa,  o  padre  pediu  atenção.  O  plural  de  atenção  é  atenções.  Já  manda  embora  também.  Olha,  pessoa  é  sobrecomum.  Entendeu?  Sobrecomum.  Mas,  já  não  dá  pra  ser.  Patrão  é  patrões,  manda  embora.  E  assaltante  é  comum  de  dois.  Letra  D.  Ao  referir -se  à  forma  como  tratava  sua  colega.  Não  dá  pra  ser,  porque  colega  é  comum  de  dois.  É  o  colega,  é  a  colega.  Entendeu?  Então,  nesse  caso,  parece  que  vai  ser  a  letra  E.  Quando  subiu  da  igreja,  o  sacristão,  são  sacristãos,  o  plural,  ficou  aterrorizado  com  o  acidente  e  preocupado  para  saber  se  houve  alguma  vítima.  Ou  seja,  a  vítima  aqui  é  um  substantivo  sobrecomum.  Resposta,  letra  E  de  escola.  É  nóis.  Beleza?  É  isso.  Tá  de  boa.  Aula  de  substantivo  finalizada.  Já  parta  logo  para  os  próximos  estudos.  Vamos,  contudo,  alinhar  essa  sua  preparação  rumo  à  sua  aprovação  no  concurso  dos  seus  sonhos.  Beijo  no  coração  e  até  a  próxima  aula.  Tchau!')


